/*!CK:1877086593!*//*1402976148,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["oPTgY"]); }

__d("ShortProfilesBootstrapper",["AsyncRequest","BanzaiODS","CurrentUser","JSLogger","XChatUserInfoAllAsyncControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';var l=5,m=10000,n=new k().setInt('viewer',i.getID()).getURI(),o=false,p=null,q=0,r=0,s=0,t=false,u=false,v=j.create('short_profiles'),w={fetchAll:function(da){x();if(o||p)return;if(q>=l){ca();return;}q++;y();p=new g(n).setHandler(function(ea){p=null;o=true;z();da(ea.payload);}).setErrorHandler(function(){p=null;r++;aa();}).setTimeoutHandler(m,function(){p=null;s++;ba();});p.send();},isBootstrapped:function(){return o;},isBootstrapping:function(){return !!p;},getAttemptCount:function(){return q;},getErrorCount:function(){return r;}};function x(){if(!t){v.log('bootstrap_start');h.bumpEntityKey('chat.web','typeahead.bootstrap.starts');t=true;}}function y(){v.log('bootstrap_attempt');h.bumpEntityKey('chat.web','typeahead.bootstrap.attempts');}function z(){v.log('bootstrap_success');h.bumpEntityKey('chat.web','typeahead.bootstrap.successes');if(q>1)h.bumpEntityKey('chat.web','typeahead.bootstrap.successes_after_retries');}function aa(){v.log('bootstrap_error');h.bumpEntityKey('chat.web','typeahead.bootstrap.errors');}function ba(){v.log('bootstrap_timeout');h.bumpEntityKey('chat.web','typeahead.bootstrap.timeouts');}function ca(){if(!u){v.log('bootstrap_giveup');h.bumpEntityKey('chat.web','typeahead.bootstrap.giveups');u=true;}}e.exports=w;},null);